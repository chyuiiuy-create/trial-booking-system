<!DOCTYPE html>
<html lang="zh-HK">
<!-- 
============================================
è©¦å ‚é ç´„ç³»çµ± - å®¶é•·ç¢ºèªé ç´„é é¢
============================================
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¢ºèªé ç´„ - é¦™æ¸¯è³ªå¿ƒæ•™è‚²</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        .confirm-container {
            max-width: 450px;
            width: 100%;
        }
        .confirm-card {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .confirm-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .confirm-title {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .confirm-subtitle {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        .booking-details {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: left;
        }
        .detail-row {
            display: flex;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .detail-label {
            width: 80px;
            font-size: 13px;
            color: #7f8c8d;
        }
        .detail-value {
            flex: 1;
            font-size: 14px;
            color: #2c3e50;
            font-weight: 500;
        }
        .confirm-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 12px;
        }
        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
        }
        .confirm-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .change-link {
            display: inline-block;
            color: #667eea;
            font-size: 14px;
            text-decoration: none;
            margin-top: 10px;
        }
        .change-link:hover {
            text-decoration: underline;
        }
        .success-state {
            display: none;
        }
        .success-state.active {
            display: block;
        }
        .pending-state.hidden {
            display: none;
        }
        .success-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        .success-title {
            font-size: 28px;
            font-weight: 700;
            color: #27ae60;
            margin-bottom: 16px;
        }
        .success-message {
            font-size: 15px;
            color: #666;
            line-height: 1.6;
        }
        .location-info {
            background: #e8f5e9;
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
            text-align: left;
        }
        .location-info h4 {
            font-size: 14px;
            color: #27ae60;
            margin-bottom: 12px;
        }
        .location-info p {
            font-size: 13px;
            color: #2c3e50;
            margin-bottom: 6px;
        }
        .error-state {
            display: none;
        }
        .error-state.active {
            display: block;
        }
        .error-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .error-title {
            font-size: 20px;
            color: #e74c3c;
            margin-bottom: 10px;
        }
        .error-message {
            font-size: 14px;
            color: #666;
        }
        .footer-text {
            margin-top: 30px;
            font-size: 12px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="confirm-container">
        <div class="confirm-card">
            <!-- å¾…ç¢ºèªç‹€æ…‹ -->
            <div class="pending-state" id="pending-state">
                <div class="confirm-icon">ğŸ“…</div>
                <h1 class="confirm-title">ç¢ºèªæ‚¨çš„é ç´„</h1>
                <p class="confirm-subtitle">è«‹ç¢ºèªä»¥ä¸‹é ç´„è©³æƒ…</p>
                
                <div class="booking-details">
                    <div class="detail-row">
                        <span class="detail-label">å­¸ç”Ÿå§“å</span>
                        <span class="detail-value" id="detail-name">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">é ç´„æ—¥æœŸ</span>
                        <span class="detail-value" id="detail-date">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">é ç´„æ™‚é–“</span>
                        <span class="detail-value" id="detail-time">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ç§‘ç›®</span>
                        <span class="detail-value" id="detail-subject">-</span>
                    </div>
                </div>
                
                <button class="confirm-btn" id="confirm-btn" onclick="confirmBooking()">
                    âœ“ ç¢ºèªé ç´„
                </button>
                
                <a href="#" class="change-link" id="change-link">éœ€è¦æ›´æ”¹æ™‚é–“ï¼Ÿ</a>
            </div>
            
            <!-- æˆåŠŸç‹€æ…‹ -->
            <div class="success-state" id="success-state">
                <div class="success-icon">ğŸ‰</div>
                <h1 class="success-title">é ç´„å·²ç¢ºèªï¼</h1>
                <p class="success-message">
                    æ„Ÿè¬æ‚¨ç¢ºèªé ç´„ã€‚<br>
                    æˆ‘å€‘æœŸå¾…èˆ‡æ‚¨è¦‹é¢ï¼
                </p>
                
                <div class="location-info">
                    <h4>ğŸ“ ä¸Šèª²åœ°é»</h4>
                    <p><strong>é¦™æ¸¯è³ªå¿ƒæ•™è‚²</strong></p>
                    <p>ä¹é¾å¤ªå­å½Œæ•¦é“761è™Ÿå¤ªå­è—é¦¬ä¹‹åŸ3æ¨“Bå®¤</p>
                    <p>ï¼ˆå¤ªå­åœ°éµç«™C1å‡ºå£ï¼‰</p>
                    <p style="margin-top: 10px;"><a href="https://wa.me/85257651008" target="_blank" style="display: inline-flex; align-items: center; gap: 6px; color: #25D366; text-decoration: none; font-weight: 600;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#25D366"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                        WhatsApp: 5765 1008
                    </a></p>
                </div>
                
                <p class="footer-text">
                    è«‹æ–¼é ç´„æ™‚é–“å‰10åˆ†é˜åˆ°é”
                </p>
            </div>
            
            <!-- éŒ¯èª¤ç‹€æ…‹ -->
            <div class="error-state" id="error-state">
                <div class="error-icon">âš ï¸</div>
                <h1 class="error-title">ç„¡æ³•è¼‰å…¥é ç´„</h1>
                <p class="error-message">
                    è«‹ç¢ºèªé€£çµæ˜¯å¦æ­£ç¢ºã€‚<br>
                    å¦‚æœ‰å•é¡Œï¼Œè«‹ <a href="https://wa.me/85257651008" target="_blank" style="color: #25D366; font-weight: 600;">WhatsApp è¯çµ¡æˆ‘å€‘</a>
                </p>
            </div>
            
            <!-- éæœŸç‹€æ…‹ -->
            <div class="error-state" id="expired-state">
                <div class="error-icon">âŒ›</div>
                <h1 class="error-title" style="color: #95a5a6;">é ç´„å·²éæœŸ</h1>
                <p class="error-message">
                    å¾ˆæŠ±æ­‰ï¼Œæ­¤é ç´„å·²è¶…éç¢ºèªæœŸé™ã€‚<br>
                    è«‹é‡æ–°é ç´„æˆ–è‡´é›»æˆ‘å€‘å®‰æ’ã€‚
                </p>
                <a href="index.html" style="display: inline-block; margin-top: 20px; padding: 12px 24px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">é‡æ–°é ç´„</a>
            </div>
        </div>
    </div>
    
    <script>
        // Google Apps Script URL
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzW4sqzfRtVPE9Bf-SWsE06Ozouvd4YllT6o82AXoFN6MktZYzdUNk07TQ-bxABwy6kPQ/exec';
        
        // å¾ URL ç²å–åƒæ•¸
        const urlParams = new URLSearchParams(window.location.search);
        const bookingId = urlParams.get('id');
        const studentName = urlParams.get('name');
        const confirmedDate = urlParams.get('date');
        const confirmedTime = urlParams.get('time');
        const subject = urlParams.get('subject');
        
        // æª¢æŸ¥é ç´„æ˜¯å¦éæœŸ
        function isExpired(dateStr) {
            if (!dateStr) return false;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // å˜—è©¦è§£æ "XæœˆYæ—¥" æ ¼å¼
            const cnMatch = dateStr.match(/(\d{1,2})æœˆ(\d{1,2})æ—¥/);
            if (cnMatch) {
                const month = parseInt(cnMatch[1]) - 1;
                const day = parseInt(cnMatch[2]);
                let bookingDate = new Date(today.getFullYear(), month, day);
                if (bookingDate < today && month < today.getMonth()) {
                    bookingDate.setFullYear(today.getFullYear() + 1);
                }
                return bookingDate < today;
            }
            
            // å˜—è©¦è§£æ "M/D" æ ¼å¼
            const slashMatch = dateStr.match(/(\d{4}\/)?(\d{1,2})\/(\d{1,2})/);
            if (slashMatch) {
                const year = slashMatch[1] ? parseInt(slashMatch[1]) : today.getFullYear();
                const month = parseInt(slashMatch[2]) - 1;
                const day = parseInt(slashMatch[3]);
                const bookingDate = new Date(year, month, day);
                return bookingDate < today;
            }
            
            return false;
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            if (!bookingId || !studentName) {
                showError();
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦éæœŸ
            const dateStr = decodeURIComponent(confirmedDate || '');
            if (isExpired(dateStr)) {
                showExpired();
                return;
            }
            
            // é¡¯ç¤ºé ç´„è©³æƒ…
            document.getElementById('detail-name').textContent = decodeURIComponent(studentName);
            document.getElementById('detail-date').textContent = dateStr || '-';
            document.getElementById('detail-time').textContent = decodeURIComponent(confirmedTime || '-');
            document.getElementById('detail-subject').textContent = decodeURIComponent(subject || '-');
            
            // è¨­ç½®æ›´æ”¹é€£çµ
            const manageUrl = 'manage.html?' + 
                'id=' + encodeURIComponent(bookingId) +
                '&name=' + encodeURIComponent(studentName) +
                '&date=' + encodeURIComponent(confirmedDate || '') +
                '&time=' + encodeURIComponent(confirmedTime || '') +
                '&subject=' + encodeURIComponent(subject || '');
            document.getElementById('change-link').href = manageUrl;
        });
        
        // ç¢ºèªé ç´„
        function confirmBooking() {
            const btn = document.getElementById('confirm-btn');
            btn.disabled = true;
            btn.textContent = 'ç¢ºèªä¸­...';
            
            // ç™¼é€ç¢ºèªåˆ° Google Sheets
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'clientConfirm',
                    bookingId: bookingId
                })
            }).then(() => {
                showSuccess();
            }).catch(err => {
                console.error(err);
                // å³ä½¿å‡ºéŒ¯ä¹Ÿé¡¯ç¤ºæˆåŠŸï¼ˆå› ç‚º no-cors æ¨¡å¼ç„¡æ³•è®€å–éŸ¿æ‡‰ï¼‰
                showSuccess();
            });
        }
        
        function showSuccess() {
            document.getElementById('pending-state').classList.add('hidden');
            document.getElementById('success-state').classList.add('active');
        }
        
        function showError() {
            document.getElementById('pending-state').classList.add('hidden');
            document.getElementById('error-state').classList.add('active');
        }
        
        function showExpired() {
            document.getElementById('pending-state').classList.add('hidden');
            document.getElementById('expired-state').classList.add('active');
        }
    </script>
</body>
</html>

